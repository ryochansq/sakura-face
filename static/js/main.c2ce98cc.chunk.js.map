{"version":3,"sources":["hooks/useApi.ts","components/TweetButton.tsx","components/Pictures.tsx","App.tsx","index.tsx"],"names":["axios","defaults","baseURL","detect","file","a","headers","post","response","data","findSimilar","faceId","useStyles","makeStyles","createStyles","tweet","color","fontWeight","textTransform","TweetButton","students","classes","Button","className","variant","onClick","subText","reduce","acc","student","name","confidence","toFixed","text","encodedText","encodeURIComponent","intent","window","open","pictureContainer","position","loaded","width","objectFit","rightGrid","aspectRatio","studentPicture","height","Pictures","useState","undefined","imageData","setImageData","imgRef","useRef","faces","setFaces","setStudents","loading","setLoading","selectedFaceNum","setSelectedFaceNum","widthRatio","current","naturalWidth","heightRatio","naturalHeight","onClickFaceRect","index","newStudents","onChangeInput","e","target","files","length","reader","FileReader","readAsDataURL","onload","result","newFaces","Grid","item","container","direction","xs","justify","alignItems","ref","src","alt","map","face","type","style","backgroundColor","border","faceNum","cursor","left","faceRectangle","top","CircularProgress","Typography","component","disabled","accept","hidden","onChange","spacing","theme","createMuiTheme","palette","secondary","main","title","flexGrow","padding","body","App","ThemeProvider","AppBar","Toolbar","Container","maxWidth","Paper","Link","href","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.c2ce98cc.chunk.js","sourcesContent":["import axios from 'axios';\n\naxios.defaults.baseURL =\n  'https://jzzezp7bhc.execute-api.ap-northeast-1.amazonaws.com/dev/';\n\nexport const detect = async (file: File): Promise<Face[]> => {\n  const headers = { 'content-type': 'application/octet-stream' };\n  const response = await axios.post<Face[]>('/detect', file, { headers });\n  return response.data;\n};\n\nexport const findSimilar = async (faceId: string): Promise<Student[]> => {\n  const response = await axios.post<Student[]>('/findSimilar', { faceId });\n  return response.data;\n};\n","import { VFC } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { Button } from '@material-ui/core';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    tweet: {\n      color: 'white',\n      fontWeight: 700,\n      textTransform: 'none',\n    },\n  })\n);\n\ntype Props = {\n  students: Student[];\n};\n\nconst TweetButton: VFC<Props> = ({ students }: Props) => {\n  const classes = useStyles();\n\n  const tweet = () => {\n    const subText = students.reduce(\n      (acc, student) =>\n        `${acc}${student.name} ... 類似度 ${(student.confidence * 100).toFixed(\n          1\n        )}%\\n`,\n      ''\n    );\n    const text = `さくら学院の誰に似てるか判定しました！\\n\\n${subText}\\nryochansq.github.io/sakura-face/\\n\\n#さくら学院の誰に似てるかな\\n#さくら学院 #さくら学院父兄パソコン部`;\n    const encodedText = encodeURIComponent(text);\n    const intent = `https://twitter.com/intent/tweet?text=${encodedText}`;\n    window.open(intent);\n  };\n\n  return (\n    <Button\n      className={classes.tweet}\n      variant=\"contained\"\n      color=\"secondary\"\n      onClick={tweet}\n    >\n      Twitterで共有\n    </Button>\n  );\n};\n\nexport default TweetButton;\n","import React, { VFC, useState, useRef } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { Button, CircularProgress, Grid, Typography } from '@material-ui/core';\nimport { detect, findSimilar } from '../hooks/useApi';\nimport TweetButton from './TweetButton';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    pictureContainer: {\n      position: 'relative',\n    },\n    loaded: {\n      width: '100%',\n      objectFit: 'contain',\n    },\n    rightGrid: {\n      aspectRatio: '500 / 634',\n    },\n    studentPicture: {\n      width: '100%',\n      height: '100%',\n      objectFit: 'scale-down',\n    },\n    tweet: {\n      color: 'white',\n      fontWeight: 700,\n      textTransform: 'none',\n    },\n  })\n);\n\nconst Pictures: VFC = () => {\n  const classes = useStyles();\n  const [imageData, setImageData] = useState<string | undefined>(undefined);\n  const imgRef = useRef<HTMLImageElement>(null);\n  const [faces, setFaces] = useState<Face[]>([]);\n  const [students, setStudents] = useState<Student[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [selectedFaceNum, setSelectedFaceNum] = useState(-1);\n\n  const widthRatio = imgRef.current ? 100 / imgRef.current.naturalWidth : 0;\n  const heightRatio = imgRef.current ? 100 / imgRef.current.naturalHeight : 0;\n\n  const onClickFaceRect = async (faceId: string, index: number) => {\n    setSelectedFaceNum(index);\n    setLoading(true);\n    const newStudents = await findSimilar(faceId);\n    setStudents(newStudents);\n    setLoading(false);\n  };\n\n  const onChangeInput = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { target } = e;\n    const { files } = target;\n    const file = files && files.length ? files[0] : null;\n    if (!file) return;\n\n    setLoading(true);\n    setFaces([]);\n    setStudents([]);\n    setSelectedFaceNum(-1);\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => {\n      const { result } = reader;\n      setImageData(result as string);\n    };\n    const newFaces = await detect(file);\n    setFaces(newFaces);\n    setLoading(false);\n    if (newFaces.length === 1) await onClickFaceRect(newFaces[0].faceId, 0);\n  };\n\n  const rectColor = (faceNum: number): string => {\n    if (selectedFaceNum === -1) return 'blue';\n    if (faceNum === selectedFaceNum) return 'red';\n    return 'white';\n  };\n\n  return (\n    <>\n      {imageData && (\n        <Grid item container>\n          <Grid item container direction=\"row\">\n            <Grid item container xs={6} justify=\"center\" alignItems=\"center\">\n              <Grid className={classes.pictureContainer} item container>\n                <img\n                  ref={imgRef}\n                  src={imageData}\n                  alt=\"選択画像\"\n                  className={classes.loaded}\n                />\n                {faces.map((face, index) => (\n                  <button\n                    key={face.faceId}\n                    onClick={() => onClickFaceRect(face.faceId, index)}\n                    type=\"button\"\n                    style={{\n                      backgroundColor: 'transparent',\n                      border: `2px solid ${rectColor(index)}`,\n                      color: 'transparent',\n                      cursor: 'pointer',\n                      position: 'absolute',\n                      left: `${face.faceRectangle.left * widthRatio}%`,\n                      top: `${face.faceRectangle.top * heightRatio}%`,\n                      width: `${face.faceRectangle.width * widthRatio}%`,\n                      height: `${face.faceRectangle.height * heightRatio}%`,\n                    }}\n                  >\n                    :\n                  </button>\n                ))}\n              </Grid>\n            </Grid>\n            <Grid\n              item\n              container\n              xs={6}\n              justify=\"center\"\n              alignItems=\"center\"\n              className={classes.rightGrid}\n            >\n              {(() => {\n                if (loading) return <CircularProgress />;\n                if (students.length > 0)\n                  return (\n                    <img\n                      className={classes.studentPicture}\n                      src={`students/${students[0].name}.jpg`}\n                      alt={`${students[0].name}`}\n                    />\n                  );\n                return (\n                  <Typography>\n                    判定したい顔を\n                    <br />\n                    タップしてください\n                  </Typography>\n                );\n              })()}\n            </Grid>\n          </Grid>\n        </Grid>\n      )}\n      {!imageData && (\n        <Grid item container justify=\"center\">\n          <img src=\"camera_kao_ninshiki.png\" alt=\"顔認識\" />\n        </Grid>\n      )}\n      {!students.length && (\n        <Grid item container justify=\"center\">\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            component=\"label\"\n            disabled={loading}\n          >\n            {imageData ? '別の画像を選択' : '判定したい画像を選択'}\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              hidden\n              onChange={onChangeInput}\n            />\n          </Button>\n        </Grid>\n      )}\n      {students.length > 0 && !loading && (\n        <>\n          <Grid item container justify=\"center\">\n            <Typography>\n              この人物は <b>{students[0].name}</b>{' '}\n              {students[0].confidence >= 0.7 ? 'です！' : 'に似ています！'}\n            </Typography>\n          </Grid>\n          <Grid item container>\n            {students.map((student) => (\n              <Grid item container justify=\"center\" key={student.name}>\n                <Typography>\n                  {student.name} ... 類似度{' '}\n                  {(student.confidence * 100).toFixed(1)}%\n                </Typography>\n              </Grid>\n            ))}\n          </Grid>\n          <Grid item container direction=\"row\" justify=\"center\" spacing={2}>\n            <Grid item>\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                component=\"label\"\n                disabled={loading}\n              >\n                別の画像で試す\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  hidden\n                  onChange={onChangeInput}\n                />\n              </Button>\n            </Grid>\n            <Grid item>\n              <TweetButton students={students} />\n            </Grid>\n          </Grid>\n        </>\n      )}\n    </>\n  );\n};\n\nexport default Pictures;\n","import { VFC } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport {\n  AppBar,\n  Container,\n  createMuiTheme,\n  Grid,\n  Link,\n  Paper,\n  ThemeProvider,\n  Toolbar,\n  Typography,\n} from '@material-ui/core';\nimport Pictures from './components/Pictures';\n\nconst theme = createMuiTheme({\n  palette: {\n    secondary: {\n      main: '#00acee',\n    },\n  },\n});\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    title: {\n      flexGrow: 1,\n    },\n    container: {\n      padding: 0,\n    },\n    body: {\n      padding: 8,\n    },\n  })\n);\n\nconst App: VFC = () => {\n  const classes = useStyles();\n\n  return (\n    <>\n      <ThemeProvider theme={theme}>\n        <AppBar position=\"static\">\n          <Toolbar variant=\"dense\">\n            <Typography variant=\"h6\" className={classes.title}>\n              さくら学院の誰に似てるかな（開発中）\n            </Typography>\n          </Toolbar>\n        </AppBar>\n        <Container maxWidth=\"md\" className={classes.container}>\n          <Paper className={classes.body}>\n            <Grid container spacing={2}>\n              <Grid item>\n                <Typography>\n                  画像に写っている人が、さくら学院の中で\n                  <b>どの生徒にどのくらい似ているか</b>判定するよ！\n                </Typography>\n                <Typography variant=\"caption\">\n                  ※画像は判定のため\n                  <Link\n                    href=\"https://azure.microsoft.com/ja-jp/services/cognitive-services/face/#demo\"\n                    target=\"_blank\"\n                  >\n                    Microsoft\n                  </Link>\n                  へ送信されます、それ以外には使用されません\n                </Typography>\n              </Grid>\n              <Pictures />\n              <Grid item container justify=\"flex-end\">\n                <Typography variant=\"caption\">\n                  開発：{' '}\n                  <Link\n                    href=\"https://twitter.com/ryochan_metal\"\n                    target=\"_blank\"\n                  >\n                    @ryochan_metal\n                  </Link>\n                </Typography>\n              </Grid>\n            </Grid>\n          </Paper>\n        </Container>\n      </ThemeProvider>\n    </>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n"],"sourceRoot":""}
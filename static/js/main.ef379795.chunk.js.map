{"version":3,"sources":["hooks/useApi.ts","components/TweetButton.tsx","components/Pictures.tsx","App.tsx","index.tsx"],"names":["axios","defaults","baseURL","detect","file","a","headers","post","response","data","findSimilar","faceId","useStyles","makeStyles","createStyles","tweet","color","fontWeight","textTransform","TweetButton","students","classes","Button","className","variant","onClick","subText","reduce","acc","student","name","confidence","toFixed","text","encodedText","encodeURIComponent","intent","window","open","pictureContainer","width","position","loaded","height","objectFit","rightGrid","aspectRatio","studentPicture","Pictures","useState","undefined","imageData","setImageData","imgRef","useRef","faces","setFaces","setStudents","loading","setLoading","selectedFaceNum","setSelectedFaceNum","rectPos","face","type","wr","current","naturalWidth","hr","naturalHeight","ratio","some","val","px","faceRectangle","onClickFaceRect","index","newStudents","onChangeInput","e","target","files","length","reader","FileReader","readAsDataURL","onload","result","newFaces","Grid","item","container","direction","xs","justify","alignItems","ref","src","alt","map","style","backgroundColor","border","faceNum","cursor","padding","left","top","CircularProgress","Typography","component","disabled","accept","hidden","onChange","spacing","theme","createMuiTheme","palette","secondary","main","title","flexGrow","body","App","ThemeProvider","AppBar","Toolbar","Container","maxWidth","Paper","Link","href","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ef379795.chunk.js","sourcesContent":["import axios from 'axios';\n\naxios.defaults.baseURL =\n  'https://jzzezp7bhc.execute-api.ap-northeast-1.amazonaws.com/dev/';\n\nexport const detect = async (file: File): Promise<Face[]> => {\n  const headers = { 'content-type': 'application/octet-stream' };\n  const response = await axios.post<Face[]>('/detect', file, { headers });\n  return response.data;\n};\n\nexport const findSimilar = async (faceId: string): Promise<Student[]> => {\n  const response = await axios.post<Student[]>('/findSimilar', { faceId });\n  return response.data;\n};\n","import { VFC } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { Button } from '@material-ui/core';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    tweet: {\n      color: 'white',\n      fontWeight: 700,\n      textTransform: 'none',\n    },\n  })\n);\n\ntype Props = {\n  students: Student[];\n};\n\nconst TweetButton: VFC<Props> = ({ students }: Props) => {\n  const classes = useStyles();\n\n  const tweet = () => {\n    const subText = students.reduce(\n      (acc, student) =>\n        `${acc}${student.name} ... 類似度 ${(student.confidence * 100).toFixed(\n          1\n        )}%\\n`,\n      ''\n    );\n    const text = `さくら学院の誰に似てるか判定しました！\\n\\n${subText}\\nryochansq.github.io/sakura-face/\\n\\n#さくら学院の誰に似てるかな\\n#さくら学院 #さくら学院父兄パソコン部`;\n    const encodedText = encodeURIComponent(text);\n    const intent = `https://twitter.com/intent/tweet?text=${encodedText}`;\n    window.open(intent);\n  };\n\n  return (\n    <Button\n      className={classes.tweet}\n      variant=\"contained\"\n      color=\"secondary\"\n      onClick={tweet}\n    >\n      Twitterで共有\n    </Button>\n  );\n};\n\nexport default TweetButton;\n","import React, { VFC, useState, useRef } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { Button, CircularProgress, Grid, Typography } from '@material-ui/core';\nimport { detect, findSimilar } from '../hooks/useApi';\nimport TweetButton from './TweetButton';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    pictureContainer: {\n      width: '100%',\n      position: 'relative',\n    },\n    loaded: {\n      width: '100%',\n      height: '100%',\n      objectFit: 'contain',\n    },\n    rightGrid: {\n      aspectRatio: '500 / 634',\n    },\n    studentPicture: {\n      width: '100%',\n      height: '100%',\n      objectFit: 'contain',\n    },\n    tweet: {\n      color: 'white',\n      fontWeight: 700,\n      textTransform: 'none',\n    },\n  })\n);\n\nconst Pictures: VFC = () => {\n  const classes = useStyles();\n  const [imageData, setImageData] = useState<string | undefined>(undefined);\n  const imgRef = useRef<HTMLImageElement>(null);\n  const [faces, setFaces] = useState<Face[]>([]);\n  const [students, setStudents] = useState<Student[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [selectedFaceNum, setSelectedFaceNum] = useState(-1);\n\n  const rectPos = (face: Face, type: keyof Face['faceRectangle']): string => {\n    const wr = imgRef.current ? 100 / imgRef.current.naturalWidth : 0;\n    const hr = imgRef.current ? 100 / imgRef.current.naturalHeight : 0;\n    const ratio = ['left', 'width'].some((val) => val === type) ? wr : hr;\n    const px = ['left', 'top'].some((val) => val === type) ? -2 : 4;\n    return `calc(${face.faceRectangle[type] * ratio}% + ${px}px)`;\n  };\n\n  const onClickFaceRect = async (faceId: string, index: number) => {\n    setSelectedFaceNum(index);\n    setLoading(true);\n    const newStudents = await findSimilar(faceId);\n    setStudents(newStudents);\n    setLoading(false);\n  };\n\n  const onChangeInput = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { target } = e;\n    const { files } = target;\n    const file = files && files.length ? files[0] : null;\n    if (!file) return;\n\n    setLoading(true);\n    setFaces([]);\n    setStudents([]);\n    setSelectedFaceNum(-1);\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => {\n      const { result } = reader;\n      setImageData(result as string);\n    };\n    const newFaces = await detect(file);\n    setFaces(newFaces);\n    setLoading(false);\n    if (newFaces.length === 1) await onClickFaceRect(newFaces[0].faceId, 0);\n  };\n\n  const rectColor = (faceNum: number): string => {\n    if (selectedFaceNum === -1) return 'blue';\n    if (faceNum === selectedFaceNum) return 'red';\n    return 'white';\n  };\n\n  return (\n    <>\n      {imageData && (\n        <Grid item container>\n          <Grid item container direction=\"row\">\n            <Grid item container xs={6} justify=\"center\" alignItems=\"center\">\n              <Grid className={classes.pictureContainer} item container>\n                <img\n                  ref={imgRef}\n                  src={imageData}\n                  alt=\"選択画像\"\n                  className={classes.loaded}\n                />\n                {faces.map((face, index) => (\n                  <button\n                    key={face.faceId}\n                    onClick={() => onClickFaceRect(face.faceId, index)}\n                    type=\"button\"\n                    style={{\n                      backgroundColor: 'transparent',\n                      border: `2px solid ${rectColor(index)}`,\n                      color: 'transparent',\n                      cursor: 'pointer',\n                      position: 'absolute',\n                      padding: 0,\n                      left: rectPos(face, 'left'),\n                      top: rectPos(face, 'top'),\n                      width: rectPos(face, 'width'),\n                      height: rectPos(face, 'height'),\n                    }}\n                  >\n                    :\n                  </button>\n                ))}\n              </Grid>\n            </Grid>\n            <Grid\n              item\n              container\n              xs={6}\n              justify=\"center\"\n              alignItems=\"center\"\n              className={classes.rightGrid}\n            >\n              {(() => {\n                if (loading) return <CircularProgress />;\n                if (students.length > 0)\n                  return (\n                    <img\n                      className={classes.studentPicture}\n                      src={`students/${students[0].name}.jpg`}\n                      alt={`${students[0].name}`}\n                    />\n                  );\n                return (\n                  <Typography>\n                    判定したい顔を\n                    <br />\n                    タップしてください\n                  </Typography>\n                );\n              })()}\n            </Grid>\n          </Grid>\n        </Grid>\n      )}\n      {!imageData && (\n        <Grid item container justify=\"center\">\n          <img src=\"camera_kao_ninshiki.png\" alt=\"顔認識\" />\n        </Grid>\n      )}\n      {!students.length && (\n        <Grid item container justify=\"center\">\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            component=\"label\"\n            disabled={loading}\n          >\n            {imageData ? '別の画像を選択' : '判定したい画像を選択'}\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              hidden\n              onChange={onChangeInput}\n            />\n          </Button>\n        </Grid>\n      )}\n      {students.length > 0 && !loading && (\n        <>\n          <Grid item container justify=\"center\">\n            <Typography>\n              この人物は <b>{students[0].name}</b>{' '}\n              {students[0].confidence >= 0.7 ? 'です！' : 'に似ています！'}\n            </Typography>\n          </Grid>\n          <Grid item container>\n            {students.map((student) => (\n              <Grid item container justify=\"center\" key={student.name}>\n                <Typography>\n                  {student.name} ... 類似度{' '}\n                  {(student.confidence * 100).toFixed(1)}%\n                </Typography>\n              </Grid>\n            ))}\n          </Grid>\n          <Grid item container direction=\"row\" justify=\"center\" spacing={2}>\n            <Grid item>\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                component=\"label\"\n                disabled={loading}\n              >\n                別の画像で試す\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  hidden\n                  onChange={onChangeInput}\n                />\n              </Button>\n            </Grid>\n            <Grid item>\n              <TweetButton students={students} />\n            </Grid>\n          </Grid>\n        </>\n      )}\n    </>\n  );\n};\n\nexport default Pictures;\n","import { VFC } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport {\n  AppBar,\n  Container,\n  createMuiTheme,\n  Grid,\n  Link,\n  Paper,\n  ThemeProvider,\n  Toolbar,\n  Typography,\n} from '@material-ui/core';\nimport Pictures from './components/Pictures';\n\nconst theme = createMuiTheme({\n  palette: {\n    secondary: {\n      main: '#00acee',\n    },\n  },\n});\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    title: {\n      flexGrow: 1,\n    },\n    container: {\n      padding: 0,\n    },\n    body: {\n      padding: 8,\n    },\n  })\n);\n\nconst App: VFC = () => {\n  const classes = useStyles();\n\n  return (\n    <>\n      <ThemeProvider theme={theme}>\n        <AppBar position=\"static\">\n          <Toolbar variant=\"dense\">\n            <Typography variant=\"h6\" className={classes.title}>\n              さくら学院の誰に似てるかな（開発中）\n            </Typography>\n          </Toolbar>\n        </AppBar>\n        <Container maxWidth=\"md\" className={classes.container}>\n          <Paper className={classes.body}>\n            <Grid container spacing={2}>\n              <Grid item>\n                <Typography>\n                  画像に写っている人が、さくら学院の中で\n                  <b>どの生徒にどのくらい似ているか</b>判定するよ！\n                </Typography>\n                <Typography variant=\"caption\">\n                  ※画像は判定のため\n                  <Link\n                    href=\"https://azure.microsoft.com/ja-jp/services/cognitive-services/face/#demo\"\n                    target=\"_blank\"\n                  >\n                    Microsoft\n                  </Link>\n                  へ送信されます、それ以外には使用されません\n                </Typography>\n              </Grid>\n              <Pictures />\n              <Grid item container justify=\"flex-end\">\n                <Typography variant=\"caption\">\n                  開発：{' '}\n                  <Link\n                    href=\"https://twitter.com/ryochan_metal\"\n                    target=\"_blank\"\n                  >\n                    @ryochan_metal\n                  </Link>\n                </Typography>\n              </Grid>\n            </Grid>\n          </Paper>\n        </Container>\n      </ThemeProvider>\n    </>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n"],"sourceRoot":""}